{% extends 'base.html' %}
{% block title %} cfs|homepage {% endblock %}
{% block css %}
{{ block.super }}
{% load static %}
<link rel="stylesheet" href="{% static 'css/projects_templates.css' %}">
<style>
    .artefact{
        background-color:var(--primary-8);
        color:var(--font-color-10);
        border:1px solid var(--primary-10);
    }
    .primary{
        background-color:var(--btn-primary);
        color:var(--font-color-10);
    }
    
    .secondary{
        background-color:var(--btn-secondary);
        color:var(--font-color-6);
    }
    .done{
        background-color:var(--primary-8-alpha);
        color:var(--font-color-6);
    }
    .task-done{
        background-color:var(--primary-8-alpha);
        color:var(--font-color-6);
        text-decoration: line-through;
    }
</style>
{% endblock %}
{% block content %}
<main class="container-fluid my-5" id="main">   
    <div class="row">
        <div class="col-10 offset-1">
            <h1 class="text-center project-name text-info"> {{ project.name }} </h1>
            <p>
                {{ project.description }}
            </p>
        </div>
    </div>
    <div class="row">
        <div class="col-10 offset-1">
            {% if project.wireframe != '' %}
                <img src="{{project.wireframe.url}}" alt="project wireframe" class="img-fluid">
                <div>
                    <a href="{% url 'delete_wireframe' id=project.id %}" class="btn btn-danger">Delete Wireframe</a>
                </div>
            {% else %}
                <div id="projectWireframe">
                    <button id="addWireframe" class="btn primary">Add Wireframe</button>
                </div>
                <script>
                    document.getElementById('addWireframe').addEventListener('click', function(e){
                        e.preventDefault();
                        document.getElementById('projectWireframe').innerHTML = `
                            <form action="{% url 'add_wireframe' id=project.id %}" method="POST" enctype="multipart/form-data">
                                {% csrf_token %}
                                <label for="wireframe" class="fw-bold">User Flow Image</label>
                                <input type="file" name="wireframe" id="wireframe">
                                <input type="submit" value="Add Wireframe" class="btn primary">
                            </form>
                        `;
                    });
                </script>
            {% endif %}
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <H2 class="text-center my-3">Project Requirements</H2>
            <ul class="list-group my-2">
                {% for requirement in requirements %}
                <li class="list-group-item artefact" id="description-{{requirement.id}}">
                    <div class="d-flex flex-wrap justify-content-between">
                        <div>
                            <p class="ml-2">{{ requirement.description }}</p>
                        </div>
                        {% if requirement.id != 'error' %}
                        <div class="d-flex flex-wrap justify-content-between">
                            <form action="{% url 'requirement_completed' %}" id="form-{{requirement.id}}" method="POST" class="m-1">
                                {% if requirement.complete %}
                                <script>
                                    document.getElementById("form-{{requirement.id}}").action = "{% url 'requirement_uncompleted' %}";
                                    document.getElementById("description-{{requirement.id}}").classList.remove("artefact");
                                    document.getElementById("description-{{requirement.id}}").classList.add("done");
                                </script>
                                {% endif %}
                                {% csrf_token %}
                                <input type="hidden" name="id_project" value="{{project.id}}">
                                <input type="hidden" name="id_requirement" value="{{requirement.id}}">
                                <button type="submit" class="btn btn-block {{ requirement.complete|yesno:'secondary, primary' }} btn-sm">{{ requirement.complete|yesno:'Completed,Not Completed' }}</button>
                            </form>
                            <form action="{% url 'delete_requirement' %}" id="delete-{{requirement.id}}" method="POST" class="m-1">
                                {% csrf_token %}
                                <input type="hidden" name="id_project" value="{{project.id}}">
                                <input type="hidden" name="id_requirement" value="{{requirement.id}}">
                                <button type="submit" class="btn btn-block btn-danger btn-sm">Delete</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </li>
                {% endfor %}
            </ul>
            <div id="formAddRequirements"></div>
            <p>
                <a href="#" class="btn primary" id="addRequirements"> Add Requirements </a>
                <script>
                    document.getElementById("addRequirements").addEventListener("click", function(e){
                        e.preventDefault();
                        document.getElementById("formAddRequirements").innerHTML = `
                        <form action="{% url 'add_requirements' %}" method="POST" class="form">
                            {% csrf_token %}
                            <input type="hidden" name="id_project" value="{{project.id}}">
                            <input type="hidden" name="user_id" value="{{request.session.user_id}}">
                            <div class="form-group">
                                <label for="new_requirements">New Requirements</label>
                                <textarea name="new_requirements" class="form-control" id="new_requirements" rows="3" onkeydown="autoGrow(this)" onkeyup="autoGrow(this)"></textarea>
                            </div>
                            <input type="submit" value="Add" class="btn primary my-2">
                        </form>
                        `;
                        document.getElementById("addRequirements").remove();
                    });
                </script>
            </p>
        </div>
        <div class="row">
            <div class="col-12">
                <h2 class="text-center">TO DO List</h2>
                <ul class="list-group">
                    {% for todo in to_dos %}
                    <li class="list-group-item artefact">
                        <div class="d-flex flex-wrap justify-content-between">
                            <div>
                                <p class="ml-2" id="descriptionTask-{{todo.id}}">{{ todo.description }}</p>
                            </div>
                            {% if todo.id != 'error' %}
                            <div class="d-flex flex-wrap justify-content-between">
                                <form action="{% url 'todo_task_completed' %}" id="formTask-{{todo.id}}" method="POST" class="m-1">
                                    {% if todo.complete %}
                                    <script>
                                        document.getElementById("formTask-{{todo.id}}").action = "{% url 'todo_task_uncompleted' %}";
                                        document.getElementById("descriptionTask-{{todo.id}}").classList.remove("artefact");
                                        document.getElementById("descriptionTask-{{todo.id}}").classList.add("task-done");
                                    </script>
                                    {% endif %}
                                    {% csrf_token %}
                                    <input type="hidden" name="id_project" value="{{project.id}}">
                                    <input type="hidden" name="id_task" value="{{todo.id}}">
                                    <button type="submit" class="btn btn-block {{ todo.complete|yesno:'secondary, primary' }} btn-sm">{{ todo.complete|yesno:'Completed,Not Completed' }}</button>
                                </form>
                                <form action="{% url 'delete_todo_task' %}" id="delete-{{todo.id}}" method="POST" class="m-1">
                                    {% csrf_token %}
                                    <input type="hidden" name="id_project" value="{{project.id}}">
                                    <input type="hidden" name="id_task" value="{{todo.id}}">
                                    <button type="submit" class="btn btn-block btn-danger btn-sm">Delete</button>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>           
        </div>
        <div id="formAddTasks"></div>
        <p>
            <a href="#" class="btn primary my-2" id="addTasks"> Add Tasks </a>
            <script>
                document.getElementById("addTasks").addEventListener("click", function(e){
                    e.preventDefault();
                    document.getElementById("formAddTasks").innerHTML = `
                    <form action="{% url 'add_todo_task' %}" method="POST" id="formAddRequirements">
                        {% csrf_token %}
                        <input type="hidden" name="id_project" value="{{project.id}}">
                        <input type="hidden" name="user_id" value="{{request.session.user_id}}">
                        <div class="form-group">
                            <label for="new_requirements">New Requirements</label>
                            <textarea name="new_tasks" class="form-control" id="new_tasks" rows="3" onkeydown="autoGrow(this)" onkeyup="autoGrow(this)"></textarea>
                        </div>
                        <button type="submit" class="btn primary my-2">Add</button>
                    </form>
                    `;
                    document.getElementById("addTasks").remove();
                });
            </script>
        </p>
        <div class="row my-3">
            <div class=" col-10 offset-1 d-flex flex-column align-items-center">
                {% if project.user_flow_image != '' %}
                    <img src="{{project.user_flow_image.url}}" alt="user flw" class="img-fluid">
                    <div>
                        <a href="{% url 'delete_user_flow_image' id=project.id %}" class="btn btn-danger my-2"> Delete Image</a>
                    </div>
                {% else %}
                    <div id="userFlowImage">
                        <a href="#" id="addUserFlowImage" class="btn secondary">Add User Flow Image</a>
                        <script>
                            document.getElementById("addUserFlowImage").addEventListener("click", function(e){
                                e.preventDefault();
                                document.getElementById("userFlowImage").innerHTML = `
                                <form action="{% url 'add_user_flow_image' %}" method="POST" class="form" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input type="hidden" name="id_project" value="{{project.id}}">
                                    <label for="user_flow_image fw-bold">User Flow Image</label>
                                    <input type="file" name="user_flow_image" class="form-control-file" id="user_flow_image">
                                    <input type="submit" value="Add" class="btn primary">
                                </form>
                                `;
                            });
                        </script>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-10 offset-1 offset-md-3 offset-lg-5">
        <a href="/projects/{{project.id}}/edit" class="btn primary" id="edit"> Edit Project </a>
        <a href="/projects/{{project.id}}/delete" class="btn btn-danger my-2" id="delete"> Delete Project </a>
    </div>
</main>
{% endblock %}
{% block js %}
{{ block.super }}
<script src="{% static 'js/create_project.js'%}"></script>
{% endblock %}
